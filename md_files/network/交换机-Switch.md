## 交换机-Switch

1. 交换机类型
2. 交换机概念
3. 交换机协议
3. #

### 交换机基础

#### 问题排查

一般来说交换机的转发能力都是ok的，主要排查以下方向。
1、接口下是否有错包，排除单一链路故障；
2、堆叠口下是否有异常；
3、生成树是否异常；
4、可以调整下聚合模式看看；
5、在交换机上下行接口做流统，看下丢报位置在哪里。

#### 交换机类型

##### 核心交换机

https://blog.csdn.net/qq_15350605/article/details/122283363?utm_medium=distribute.pc_relevant.none-task-blog-2~default~baidujs_title~default-0.no_search_link&spm=1001.2101.3001.4242.1&utm_relevant_index=3

##### 网管交换机

网管型交换机就字面上的意思，可以网络管理的交换机，管理方式有三种，可通过串口管理、可通过Web管理、通过网管软件管理。

网管型交换机的数据，会通过简单网络管理协议(SNMP)来实现配置，SNMP协议是目前基于TCP/IP网络使用最广泛的网络管理协议，可以对数据的地址、端口、协议类型、服务等进行过滤，通常还拥有VLAN划分功能。



**端口汇聚**是网管交换机的功能，是将交换机的多个物理端口汇聚为一个逻辑端口，从而实现端口速率叠加和冗余备份。

##### 非网管交换机

非网管交换机，是相对网管型交换机而言的，非网管交换机又称为傻瓜型交换机，简单说就是它对数据是不做直接处理的，插上网线即可。非网管型交换机属于数据链路层设备,可以识别数据包中的MAC地址信息,然后根据MAC地址进行转发,并将这些MAC地址与对应的端口记录在自己内部的一个地址表中。它的优点的就是使用方便即插即用，可以大量串联使用适合PC设备密集度高的地方使用，价格便宜可以节省开支。

泛洪，学习，MAC转发

##### 非网管PoE交换机

PoE交换机供电指的是可以将电力加注在网线上，同一个网线既可以传输数据又可以传输电力。

普通的交换机虽没有PoE供电，但可以用PoE供电器来实现，不一定非要改交换机，PoE供电器与普通交换机连接，就相当于一个PoE交换机了。

https://smb.tp-link.com.cn/service/detail_article_2945.html

#### 交换机端口

##### POE端口

Power over LAN ，可以供电。

##### Uplink端口

问题： 非网管交换机（交换机又不支持 vlan）提供一个 uplink 口（uplink 口没有 poe 供电）是为了什么？

答：这个口用于和其他交换机通信，不需要 poe。否则用一个 poe 口和其他交换机通信，很浪费。

UPLINK 端口的作用是为了解决网络设备互连时的网线（交叉线和直通线）的使用问题。和有没有网管功能无关。早期的设备端口不支持 AUTO-MDI/MDIX，用错跳线无法通信。

还有部分交换是非标准 POE 供电，插错端口容易烧相连设备端口。而你这个 POE 的傻瓜交换机，设置一个 uplink 估计是因为只做了 7 个端口的 poe，专为监控、带 AP 等用途设计的，只能做上行使用了。



#### 背板带宽

https://www.cnblogs.com/liushui-sky/p/14303485.html

交换机背板总线或交换矩阵的总吞吐能力，如同高速公路的设计总宽度。

交换机的背板带宽也叫背板容量，是交换机接口处理器或接口卡和数据总线间所能吞吐的最大数据量。背板带宽标志了交换机总的数据交换能力。

**交换机的交换容量（背板带宽|交换带宽）计算方法为：端口数\*相应端口速率\*2（全双工）。**

例如一台24口百兆交换机交换容量=24\*100\*2=4800Mbit=4.8Gbps

交换机交换容量（背板带宽|交换带宽）和包转发率关系：

**交换容量=包转发速率\*8\*（64＋8＋12）\*2 (全双工)=1344\*包转发速率**

#### 包转发速率

https://www.cnblogs.com/liushui-sky/p/14303485.html

**交换机的包转发率（吞吐量|包转发能力）指的是交换机转发数据包的能力，单位是pps（包每秒)，也就是交换机每秒可以转发多少个数据包。—— 注所有端口的转发能力总和才是交换机的包转发率**

转发能力以能够处理最小包长来衡量，对于以太网最小包为**64Byte**（**由于以太网的冲突检测机制，所以以太网传输数据帧时对数据帧的大小有个限制，数据帧最小为64byte**），加上帧开销**20Byte**（**在以太网中，每个帧头都要加上了8个字节的前导符，前导符的作用在于告诉监听设备数据将要到来。然后，以太网中的每个帧之间都要有帧间隙，即每发完一个帧之后要等待一段时间再发另外一个帧，在以太网标准中规定最小是12个字节，然而帧间隙在实际应用中有可能会比12个字节要大，在这里我用了最小值。每个帧都要有20个字节的固定开销**），因此最小包为**84Byte**。

交换机接口速率：100Mbit/s的以太网接口，学过计算机的同学都知道，每8个bit组成一个字节，所以接一个百兆接口转换成节=12.5Mbyte/s，也就是说每秒这个以太网接口能转发12.5M个字节=12500000byte。**以此百兆以太口为例，一个百兆以太口每秒最多转发12500000byte的数据，假设在最糟糕的情况下所传输的所有数据帧都是最小的84byte（当然如果传输的数据帧越大对交换机转发越有利，所以我们这里假设一个极端，在最糟糕的情况下），那么这个百兆以太口每秒转发的数据帧为 12500000/84=148809pps(帧/秒或包每秒)=148.8kpps=0.1488Mpps。**

**——注：1000000K= 1000M=1G**

交换机线性无阻塞传输计算公式：

A、每种端口的速率 X 端口数量之和的2倍应该小于背板带宽，可实现全双工无阻塞交换，证明交换机具有发挥最大数据交换性能的条件。

B、满配置吞吐量(Mpps)=满配置GE端口数×1.488Mpps，其中1个千兆端口在包长为64字节时的理论吞吐量为1.488Mpps。例如，一台最多可以提供64个千兆端口的交换机，其满配置吞吐量应达到 64×1.488Mpps = 95.2Mpps，才能够确保在所有端口均线速工作时，提供无阻塞的包交换。

举例：如果一台交换机最多能够提供176个千兆端口，而宣称的吞吐量为不到261.8Mpps(176 x 1.488Mpps = 261.8)，那么用户有理由认为该交换机采用的是有阻塞的结构设计。

* 对于万兆以太网，一个线速端口的包转发率为14.88Mpps。 

* 对于千兆以太网，一个线速端口的包转发率为1.488Mpps。

#### 链路聚合

链路聚合是将两个或更多数据信道结合成一个单个的信道，该信道以一个单个的更高带宽的逻辑链路出现。

链路聚合一般用来连接一个或多个带宽需求大的设备，例如连接骨干网络的服务器或服务器群。它可以用于扩展链路带宽，提供更高的连接可靠性。

https://cloud.tencent.com/developer/news/448762

#### 链路冗余

为了保持网络的稳定性，在多台交换机组成的网络环境中，通常都使用一些备份连接，以提高网络的效率、稳定性，这里的备份连接也称为备份链路或者冗余链路。



#### 交换机协议



### 10G/40G and 25G/100G

以太网接口的传输速率在过去几十年来大体呈线性增长(每10年增长10倍)。大家的台式电脑或笔记本电脑的有线网卡基本是千兆网卡。而在当前的许多数据中心中，服务器的接口是10Gbps（万兆）, 交换机间的接口是40Gbps（四万兆），它们中的大多数都在考虑（或者正在）将网络升级到下一代的25G/100G网络（服务器的接口是25Gbps, 交换机间互联的接口是100Gbps）。

一个100Gbps连接可被分接线缆（Break-out Cable）分解为四个通道（每个通道25Gbps），所以100G网络有时被称为25G/100G网络。同理,10G网络有时也被称为10G/40G网络。

![](https://image-1300760561.cos.ap-beijing.myqcloud.com/bgyq-blog/switch-10-40-0.png)



#### 10G/40G

\1. Spine交换机和Leaf (TOR)交换机之间链路为40Gbps。

\2. 服务器接口为10Gbps，不同的Leaf交换机提供10G接口的方式及端口密度可能并不一样。

* 1)以某Leaf交换机为例，该交换机端口规格为：48\*10Gbps+6\*40Gbps ，此时Leaf 交换机提供的10G接口是Leaf交换机的原生10G接口：

  ![](https://image-1300760561.cos.ap-beijing.myqcloud.com/bgyq-blog/switch-10-40-1.png)

* 2)以某Leaf交换机为例，该交换机端口规格为：32\*40Gbps，此时该Leaf 交换机提供的10G接口是其原生的40G接口经一分四Break-out cable分接出来的(在6个端口用于上连Spine交换机的场景下，能提供(32-6)\*4=104个10G端口)：

  ![](https://image-1300760561.cos.ap-beijing.myqcloud.com/bgyq-blog/switch-10-40-2.png)

  ![](https://image-1300760561.cos.ap-beijing.myqcloud.com/bgyq-blog/switch-10-40-3.png)

  

#### 25G/100G

Spine交换机和Leaf 交换机之间链路为100Gbps

服务器接口为25Gbps不同的Leaf交换机提供25G接口的方式及端口密度可能并不一样：

* 1）以某Leaf交换机为例，该交换机端口规格为：48\*25Gbps+6\*100Gbps ，此时Leaf 交换机提供的25G接口是Leaf交换机的原生25G接口：

  ![](https://image-1300760561.cos.ap-beijing.myqcloud.com/bgyq-blog/switch-10-40-1.png)

* 2）以某Leaf交换机为例，该交换机端口规格为：32*100Gbps，此时该Leaf 交换机提供的25G接口是其原生的100G接口经一分四Break-out cable分接出来的（在6个端口用于上连Spine交换机的场景下，能提供（32-6）4=104个25G端口）：

  ![](https://image-1300760561.cos.ap-beijing.myqcloud.com/bgyq-blog/switch-10-40-2.png)

  ![](https://image-1300760561.cos.ap-beijing.myqcloud.com/bgyq-blog/switch-10-40-4.png)

  

  

### 堆叠技术: Stack

堆叠是指将多台支持堆叠特性的交换机通过堆叠线缆连接在一起，从逻辑上虚拟成一台交换设备，作为一个整体参与数据转发。堆叠是目前广泛应用的一种横向虚拟化技术，具有提高可靠性、扩展端口数量、增大带宽、简化组网等作用。

交换机采用堆叠形式组网，分别组成管理网络、业务网络和存储网络，可采用10GE或25GE进行组网。带外管理交换机主要负责在服务器宕机、管理网失效场景下进行应急管理，可采用较低配置的电口交换机。



叠加的交换机之间通过两条环路连接起来。交换机的硬件负责将数据包在双环路上做负载均衡。

目前各大网络厂商分别拥有各自的交换机堆叠技术，比如华为的iStack（Intelligent Stack）和CSS、华三的IRF（Intelligent Resilient Framework，智能弹性架构）以及思科的StackWise等等。

H3C IRF 是这个啊。



### Port

#### Trunk

```bash
[SW1] interface gigabitEthernet0/0/24
[SW1-GigabitEthernet0/0/24] port link-type trunk
[SW1-GigabitEthernet0/0/24] port trunk allow-pass vlan 10 20
```

由于VLAN Trunk可以传输多个VLAN数据，Ethernet Frame在VLAN Trunk上传输时，需要带上802.1Q定义的VLAN tag，这样交换机才能区分Ethernet Frame到底属于哪个VLAN。VLAN Trunk的具体使用过程如下：

◆    当最左侧服务器想要访问最右侧服务器，最左侧服务器将Ethernet Frame发送到左侧交换机

◆    左侧交换机本地没有目的MAC对应的转发信息，因此Ethernet Frame发送到了左侧交换机的VLAN Trunk port

◆    由于这是来自VLAN100的Ethernet Frame，交换机给Ethernet Frame打上VLAN 100的Tag，从自己的VLAN Trunk port发出，发送到右侧交换机的VLAN Trunk port

◆    右侧的VLAN Trunk port收到VLAN 100的Ethernet Frame，去除VLAN Tag，再在本地的VLAN 100端口中查找MAC转发

◆    找到对应的MAC/端口记录，最终Ethernet Frame发送到最右侧的服务器

优点

1.可以在不同的交换机之间连接多个VLAN，可以将VLAN扩展到整个网络中；

2.Trunk可以捆绑任何相关的端口，也可以随时取消设置，这样提供了很高的灵活性；

3.Trunk可以提供负载均衡能力以及系统容错。由于Trunk实时平衡各个交换机端口和服务器接口的流量，一旦某个端口出现故障，它会自动把故障端口从Trunk组中撤消，进而重新分配各个Trunk端口的流量，从而实现系统容错；

#### Channel

？

### 引用

1. https://www.sdnlab.com/21166.html
2. end
3. 
