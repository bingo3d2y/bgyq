## 虚拟化

### 虚拟化 and 网络：顶呱呱

假设，网络已经高可用了，那么接入多个网络的服务器也可以实现高可用了。对服务器来说，网络高可用的代价是至少消耗两个网卡即实现bond_mode_1(active-backup)。

如下，服务网卡可以做bond，接两个交换机的网线，实现服务网络高可用。

![](https://image-1300760561.cos.ap-beijing.myqcloud.com/bgyq-blog/DRNI-1.png)

如果，没有虚拟化技术，那么每个物理设备都需要做这个的高可用，才能实现虚拟主机的网络高可用，配置和成本都很高。

在虚拟化技术的加持下，只需要在一个物理服务器上配置网络高可用，该host上所有的虚拟机都可以复用host上的网卡。即，可以实现所以vhost的网络高可用。

### 虚拟机 and 虚拟交换机 and VLAN

虚拟化平台（类似VM vSphere 和 H3C CAS）支持标准虚拟交换机及分布式虚拟交换机。

可以把虚拟交换机，当成一个"二层"可网管的交换机来使用。普通的物理交换机支持的功能与特性，虚拟交换机也支持。组成虚拟化平台物理主机的物理网卡，可以"看成"虚拟交换机与物理交换机之间的"级联线"。

根据主机物理网卡连接到的物理端口的属性（Access、Trunk、链路聚合），可以在虚拟交换机上，以实现不同的网络功能。

#### vswitch上行access

当虚拟交换机（标准交换机或分布式交换机）上行链路（指主机物理网卡）连接到交换机的Access端口时，该虚拟交换机应该与其上行链路物理交换机端口属性相同，如果该主机物理网卡连接到一个VLAN，则该虚拟交换机要配置的VLAN ID属性和物理交换机（物理网卡在一个物理交换机的端口）的VLAN ID一直。

#### vswitch上行trunk

当虚拟交换机上行链路连接到物理交换机的Trunk端口时，虚拟交换机的配置：

* VLAN：在物理交换机Trunk端口允许的vlan id范围内随便选择一个应用到虚拟机上，虚拟机可以与其他虚拟机及物理网络通讯。
* VLAN 中继(trunk)：将虚拟网卡所链接的虚拟交换机端口也设置成trunk？？？



### 引用

1. https://www.jianshu.com/p/dfe605ca8ca7
