## 云平台设计思想

### 解耦，屏蔽底层

虚拟化平台上定义vswitch屏蔽底层物理网卡的变化为虚拟机提供稳定的网络出口。

云平台纳管虚拟化平台时，再定义一个网络出口，作为云平台操作虚拟化平台underlay网络的稳定入口，一个云平台的网络出口可用对应多个虚拟化平台的vswitch，从而实现一个网段可以分散在不同的虚拟化平台。

### 网络解耦

云平台可以下发任意网络资源，并自动通过SDN创建和维护相应的路由规则。

#### vswitch

虚拟化平台（类似VM vSphere 和 H3C CAS）支持标准虚拟交换机及分布式虚拟交换机。

可以把虚拟交换机，当成一个"二层"可网管的交换机来使用。普通的物理交换机支持的功能与特性，虚拟交换机也支持。组成虚拟化平台**物理主机的物理网卡**，可以"看成"虚拟交换机与物理交换机之间的"**级联线**"。

根据主机物理网卡连接到的物理端口的属性（Access、Trunk、链路聚合），可以在虚拟交换机上，以实现不同的网络功能。

虚拟化平台通过vswitch可以屏蔽底层物理网卡名称变化而且可以关联多个网卡实现负载或者高可用

通常，一个vswitch接入两个网卡做bond-1(active-back)。

#### 网络策略

虚拟化平台通过网络策略模板功能，可以配置：

* vlan ID: 必填，为虚拟机流量注入vlan id
* ACL：选填，可以填写基于IP或者二层的防火墙规则
* 限速策略：选填

将网络策略应用到vswitch上，可以实现虚拟机的vlan划分和网络策略配置。

### 计算解耦

做到任何云资源的横向扩容不影响底层虚拟化资源池限制，即

1. 云产品实例可以跨计算资源池部署。
2. 经典网络和VPC可以指定在多个计算资源池

### 存储解耦

### 容灾设计

### h3c 云平台设计与缺陷

#### 虚拟化和云平台

1. 虚拟化平台定义vswitch屏蔽底层物理网卡的变化为虚拟机提供稳定的网络出口

2. 云平台纳管虚拟化平台时，在定义一个网络出口，作为云平台操作虚拟化平台underlay的入口，一个云平台的网络出口可用对应多个虚拟化平台的vswitch

   ![](https://image-1300760561.cos.ap-beijing.myqcloud.com/bgyq-blog/cloudos-网络出口-vswitch.png)

   > 每次添加计算节点（虚拟化平台管理节点）时，如果使用了同名的网络出口（比如vs_business），图中对应的出口设备、nova可用域和计算节点都会自动变化。

   一个网段可以对应N个资源区域

   ![](https://image-1300760561.cos.ap-beijing.myqcloud.com/bgyq-blog/cloud-compute-and-net.png)

3. 云平台整体规划平台网络出口，为出口指定vlan范围，实现云平台下发虚机的网络可达。

这样做可以实现网络和计算解耦了。假如一个网络出口对应3个不同的虚拟化平台的vswitch，那么在这个网络出口下面建一个经典网络或者vpc，可以将网络分散到不同的虚拟化平台，实现高可用。

but，有个小问题，创建云资源时不能选择多个计算资源域即网络实现了和计算的一对多，但是下发云资源时只能选择一个计算域。比如一个云上k8s集群的规模就受限于底层的计算域（虚拟化平台）的大小，因为k8s集群不能跨计算域部署。

![](https://image-1300760561.cos.ap-beijing.myqcloud.com/bgyq-blog/cloudos设计有问题耶.jpg)

end